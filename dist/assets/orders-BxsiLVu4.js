import{R as O,u as M,r as o,b as N,j as e,I as _,s as b,J as A,M as B,g as P}from"./index-S6-I6USK.js";import{S as E,H as F}from"./header-B8u4Ziyx.js";import{S as n}from"./skeleton-2Xj4wYJM.js";import{h as y}from"./moment-BLMuvzoS.js";function Y(){const{isSidebarHidden:D}=M(),[t,j]=o.useState(1),[c,I]=o.useState(10),[a,h]=o.useState({}),[u,g]=o.useState(""),{data:p,isLoading:w,refetch:f}=N({queryKey:["ordersList",t,c],queryFn:async()=>B({page:t,pageSize:c,search:"",userId:"",year:0,month:0,startDate:"",endDate:""}),onError:s=>{console.log(s)}}),m=p?.results?.orders||[],i=Math.ceil(p?.results?.totalPages),{data:S}=N({queryKey:["deliveryBoyList"],queryFn:async()=>P({page:1,pageSize:1e3,search:"",from:"",to:"",status:""}),onError:s=>{console.log(s)}}),C=S?.results?.deliveryBoys||[],x=s=>{s>0&&s<=i&&j(s)},v=async(s,r)=>{const l={orderId:s,status:r};try{const d=await _(l);d.error?b(d.message,"error"):f()}catch{console.log("An error occurred")}},k=async s=>{const r={orderId:u,userId:s};try{const l=await A(r);l.error?b(l.message,"error"):(document.getElementById("closemodalFordel").click(),f())}catch{console.log("An error occurred")}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"admin-wrapper d-flex",children:[e.jsx(E,{}),e.jsxs("div",{className:D?"main-content flex-grow-1 full":"main-content flex-grow-1",id:"main-content",children:[e.jsx(F,{}),e.jsxs("main",{className:"p-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("div",{className:"d-flex gap-3 align-items-center justify-content-between",children:e.jsx("h3",{className:"fw-semibold fs-5",children:"Order Management"})})}),e.jsx("div",{className:"table-responsive shadow-sm rounded bg-white p-3",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No"}),e.jsx("th",{children:"Order ID"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Items"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Date"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:w?[...Array(c)].map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})}),e.jsx("td",{children:e.jsx(n,{})})]},r)):m?.length?m?.map((s,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:r+1}),e.jsxs("td",{children:["#",s.orderId]}),e.jsx("td",{children:s.userId.firstName}),e.jsx("td",{children:s.products&&s.products.map((l,d)=>e.jsxs("span",{children:[l.quantity,"x"," ",l.productId?.name_en,d<s.products.length-1?", ":""]},l._id||d))}),e.jsxs("td",{children:["₹",s.amount]}),e.jsx("td",{children:e.jsxs("select",{value:s.status,className:"form-select form-select-sm status-dropdown",onChange:l=>{const d=l.target.value;d==="Out for Delivery"?(document.getElementById("modalFordel")?.click(),g(s._id)):v(s._id,d)},children:[e.jsx("option",{value:"Pending",children:"Pending"}),e.jsx("option",{value:"Preparing",selected:!0,children:"Preparing"}),e.jsx("option",{value:"Out for Delivery",children:"Out for Delivery"}),e.jsx("option",{value:"Delivered",children:"Delivered"}),e.jsx("option",{value:"Cancelled",children:"Cancelled"})]})}),e.jsx("td",{children:y(s.createdAt).format("DD MMM YYYY, hh:mm A")}),e.jsx("td",{className:"text-center",children:e.jsx("button",{className:"table-btn bg-main me-2","data-bs-toggle":"modal","data-bs-target":"#viewOrderModal",onClick:()=>h(s),children:e.jsx("i",{className:"fa fa-eye"})})})]},s._id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center",children:"Oops! No Result Found."})})})]})})]}),m?.length?e.jsx("div",{className:"col-md-12 mt-3",children:e.jsxs("div",{className:"row align-items-center justify-content-between",children:[e.jsx("div",{className:"col-auto",children:e.jsxs("div",{className:"datafilter",children:[e.jsx("span",{children:"Showing"}),e.jsxs("select",{className:"form-select","aria-label":"Default select example",value:c,onChange:s=>{I(parseInt(s.target.value,10)),j(1)},children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:20,children:"20"})]})]})}),e.jsx("div",{className:"col-auto",children:e.jsx("div",{className:"page_txt"})}),e.jsx("div",{className:"col-auto",children:e.jsx("nav",{"aria-label":"Page navigation example",children:e.jsxs("ul",{className:"pagination border-0 gap-2",children:[e.jsx("li",{className:"page-item",children:e.jsx("button",{className:`page-link ${t===1?"disabled":""}`,onClick:()=>x(t-1),disabled:t===1,children:e.jsx("i",{class:"fa fa-angle-left"})})}),Array.from({length:i}).map((s,r)=>r+1).filter(s=>s===1||s===i||Math.abs(s-t)<=2).reduce((s,r,l,d)=>(l>0&&r-d[l-1]>1&&s.push("..."),s.push(r),s),[]).map((s,r)=>s==="..."?e.jsx("span",{className:"pagination-ellipsis",children:"..."},r):e.jsx(e.Fragment,{children:e.jsx("li",{className:"page-item",children:e.jsx("button",{className:`page-link ${t===s?"active":""}`,onClick:()=>x(s),children:s},r)})})),e.jsx("li",{className:"page-item",children:e.jsx("button",{className:`page-link ${t===i?"disabled":""}`,onClick:()=>x(t+1),disabled:t===i,children:e.jsx("i",{class:"fa fa-angle-right"})})})]})})})]})}):""]})]})]}),e.jsx("div",{className:"modal fade",id:"viewOrderModal",tabIndex:-1,"aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title text-main fw-bold",children:"Order Details"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal",onClick:()=>h({})})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"fw-bold text-main mb-2",children:"Customer Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",a?.userId?.firstName," ",a?.userId?.lastName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",a?.userId?.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",a?.userId?.phoneNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",e.jsxs("a",{href:`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${a?.address?.address_line2} ${a?.address?.address_line1}`)}`,target:"_blank",rel:"noopener noreferrer",style:{color:"#ff6b00",fontWeight:"400",textDecoration:"underline",textUnderlineOffset:"4px"},children:[e.jsx("i",{className:"fas fa-map-marker-alt me-1"}),a?.address?.address_line2," ",a?.address?.address_line1]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{className:"fw-bold text-main mb-2",children:"Merchant Details"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Shop:"})," ",a?.merchant?.shopName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",a?.merchant?.phoneNumber]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Location:"})," ",a?.merchant?.address]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"fw-bold text-main mb-2",children:"Order Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Order ID:"})," #",a?.orderId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Items:"}),a?.products&&a?.products.map((s,r)=>e.jsxs("span",{children:[s.quantity,"x ",s.productId?.name_en,r<a?.products.length-1?", ":""]},s._id||r))]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Amount:"})," ₹",a?.amount]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Payment Method:"})," UPI"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",a?.status]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Placed At:"})," ",y(a.createdAt).format("DD MMM YYYY, hh:mm A")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Expected Delivery:"})," 1 hour"]})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn comman-btn-main",onClick:()=>h({}),"data-bs-dismiss":"modal",children:"Close"})})]})})}),e.jsx("div",{className:"modal fade",id:"viewDelBoyModal",tabIndex:-1,"aria-hidden":"true","data-bs-backdrop":"static",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header",children:e.jsx("h5",{className:"modal-title text-main fw-bold",children:"Delivery Boy"})}),e.jsx("div",{className:"modal-body",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("select",{className:"form-control form-select",id:"actionSelect",onChange:s=>{v(u,"Out for Delivery"),k(s.target.value)},children:[e.jsx("option",{hidden:!0,value:"",children:"Select Delivery Boy"}),C.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName]},s._id))]})})}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn comman-btn-main",id:"closemodalFordel","data-bs-dismiss":"modal",onClick:()=>{g(""),document.getElementById("actionSelect").value=""},children:"Close"})})]})})}),e.jsx("div",{className:"d-none",id:"modalFordel","data-bs-toggle":"modal","data-bs-target":"#viewDelBoyModal"})]})}const U=O.memo(Y);export{U as default};
