import{R as K,u as Q,r as h,f as T,b,j as e,L as U,s as u,o as H,x as J,q,t as O,w as W}from"./index-D3T7aQCD.js";import{S as X,H as Y}from"./header-Ds328fsm.js";import{u as Z,C as f,F as ee}from"./index-CsDELSGv.js";import{S,C as ae}from"./compressor.esm-TxkPyhZ7.js";import{R as se}from"./quill.snow-C1FRGEdE.js";function re(){const{isSidebarHidden:_}=Q(),[N,x]=h.useState(!1),[d,m]=h.useState([]),[p,v]=h.useState([]),[P,D]=h.useState(0),y=T(),{register:g,handleSubmit:A,formState:{errors:t},watch:n,control:j,setValue:C}=Z({mode:"onChange",defaultValues:{categoryId:"",subCategoryId:""}});h.useEffect(()=>{C("subCategoryId","")},[n("categoryId")]),h.useEffect(()=>{C("valueId",""),m([])},[n("attributeId")]),h.useEffect(()=>{m([])},[n("valueId")]);const{data:F}=b({queryKey:["categoryList"],queryFn:async()=>q({page:1,pageSize:1e3,categoryId:"",allSubcategory:!1,search:""}),onError:a=>{console.log(a)}}),E=F?.results?.categories||[],{data:k}=b({queryKey:["subCategoryList",n("categoryId")],queryFn:async()=>{const a={page:1,pageSize:1e3,categoryId:n("categoryId"),allSubcategory:!0,search:""};return q(a)},enabled:!!n("categoryId"),onError:a=>{console.log(a)}}),L=k?.results?.categories||[],{data:V}=b({queryKey:["attList"],queryFn:async()=>O({page:1,pageSize:1e3,search:""}),onError:a=>{console.log(a)}}),I=V?.results?.attributes||[],{data:M}=b({queryKey:["valueList",n("attributeId")],queryFn:async()=>{const a={page:1,pageSize:1e3,attributeIds:n("attributeId"),search:""};return W(a)},enabled:!!n("attributeId"),onError:a=>{console.log(a)}}),w=M?.results?.values||[],R=async()=>{if(!n("attributeId")?.length&&!n("valueId")?.length){u("Please select attribute & value","error");return}console.log(n("attributeId"),n("valueId"));const a={selectedAttributes:n("attributeId"),selectedValues:n("valueId")};try{const s=await H(a);s.error?u(s.message,"error"):m(s.results.combinations)}catch{console.log("An error occurred")}finally{x(!1)}},$=async a=>{if(p.length<5){u("Please upload atleast 5 images","error");return}const s=d.flatMap(r=>r.filter(i=>!i.quantity||!i.price||!i.discountPrice));if(d.flatMap(r=>r.filter(i=>Number(i.discountPrice)>Number(i.price))).length>0)return;if(s.length>0){u("Please fill all required fields for variations","error");return}x(!0);const l=new FormData;l.append("name_en",a.name_en),l.append("description_en",a.description_en),l.append("categoryId",a.categoryId),l.append("subCategoryId",a.subCategoryId),l.append("calories",a.calories),l.append("type",a.type),p.forEach(r=>{l.append("images",r)});const c=d.flat().map(r=>({quantity:r.quantity||0,price:r.price||0,discountPrice:r.discountPrice||0,combination:[{attributeId:r.attributeId,valueId:r.valueId}]}));l.append("variants",JSON.stringify(c));try{const r=await J(l,i=>{D(Math.round(100*i.loaded/i.total))});r.error?u(r.message,"error"):(u(r.message,"success"),y("/merchant/products"))}catch{console.log("An error occurred")}finally{x(!1)}},z=a=>{const s=Array.from(a.target.files),o=5*1024*1024;let l=!1;s.forEach(c=>{if(c.size>o){l=!0;return}new ae(c,{quality:.6,success(r){v(i=>[...i,r])},error(r){u(`Failed to compress ${c.name}`,"error")}})}),l&&u("Some files exceed 5MB limit and were not added","error"),a.target.value=""},B=a=>{const s=p.filter((o,l)=>l!==a);v(s)};return console.log(d),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"admin-wrapper d-flex",children:[e.jsx(X,{}),e.jsxs("div",{className:_?"main-content flex-grow-1 full":"main-content flex-grow-1",id:"main-content",children:[e.jsx(Y,{}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"d-flex gap-3 align-items-center justify-content-between",children:[e.jsx("h3",{className:"fw-semibold fs-5",children:" Add Product"}),e.jsxs(U,{to:"",onClick:()=>y(-1),className:"btn btn-sm btn-light",children:[e.jsx("i",{className:"fa fa-arrow-left me-2"})," Go Back"]})]})}),e.jsx("div",{className:"card-body",children:e.jsx("form",{onSubmit:A($),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"upload-img",children:[e.jsx("input",{type:"file",id:"productImage",className:"d-none",accept:"image/*",multiple:!0,onChange:z}),e.jsxs("label",{htmlFor:"productImage",className:"upload-content",children:[e.jsx("i",{className:"fa fa-cloud-upload"}),e.jsx("p",{className:"mb-0",children:"Click to upload at least 5 images"}),e.jsx("small",{className:"text-muted",children:"PNG, JPG, JPEG (Max 5MB)"})]})]}),p.length>0&&e.jsx("div",{className:"row mt-3 g-2",children:p.map((a,s)=>e.jsxs("div",{className:"col-3 position-relative img-wrap",children:[e.jsx("img",{src:URL.createObjectURL(a),alt:`Preview ${s+1}`,className:"img-fluid rounded shadow-sm",style:{width:"100%",height:"100px",objectFit:"cover"}}),e.jsx("i",{className:"fas fa-remove",onClick:()=>B(s)})]},s))})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Product Name"}),e.jsx("input",{type:"text",placeholder:"Enter product name",className:`form-control ${t.name_en?"input-error":""}`,...g("name_en",{required:"Product Name is required"})}),t.name_en&&e.jsx("p",{className:"form-error",children:t.name_en.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsxs("select",{className:`form-control form-select ${t.categoryId?"input-error":""}`,...g("categoryId",{required:"Category  is required"}),children:[e.jsx("option",{value:"",hidden:!0,children:"Select Category"}),E?.map(a=>e.jsx("option",{value:a._id,children:a.name_en},a._id))]}),t.categoryId&&e.jsx("p",{className:"form-error",children:t.categoryId.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Subcategory"}),e.jsxs("select",{className:`form-control form-select ${t.subCategoryId?"input-error":""}`,...g("subCategoryId",{required:"Sub Category  is required"}),children:[e.jsx("option",{hidden:!0,value:"",children:"Select Sub Category"}),L?.map(a=>e.jsx("option",{value:a._id,children:a.name_en},a._id))]}),t.subCategoryId&&e.jsx("p",{className:"form-error",children:t.subCategoryId.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Calories"}),e.jsx("input",{type:"number",placeholder:"Enter calories",className:`form-control ${t.calories?"input-error":""}`,...g("calories",{required:!1})}),t.calories&&e.jsx("p",{className:"form-error",children:t.calories.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Type"}),e.jsxs("select",{className:`form-control form-select ${t.type?"input-error":""}`,...g("type",{required:"Type is required"}),children:[e.jsx("option",{value:"",hidden:!0,children:"Select Type"}),e.jsx("option",{value:"Veg",children:"Veg"}),e.jsx("option",{value:"Non Veg",children:"Non-Veg"})]}),t.type&&e.jsx("p",{className:"form-error",children:t.type.message})]}),e.jsxs("div",{className:"col-md-12 ReactQuill",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx(f,{name:"description_en",control:j,rules:{required:"Description is required",validate:a=>(a?.replace(/<[^>]*>/g,"").trim()).length>0||"Description is required"},render:({field:a})=>e.jsx(se,{theme:"snow",value:a.value||"",onChange:s=>{a.onChange(s),s.replace(/<[^>]*>/g,"").trim()===""&&a.onChange("")},onBlur:()=>{a.onBlur()},placeholder:"Enter description",className:t.description_en?"input-error":"",style:{height:"130px",marginBottom:"65px"},modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],[{font:[]}],[{size:["small",!1,"large","huge"]}],["bold","italic","underline","strike"],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{align:[]}],["blockquote","code-block"],["clean"]]}})}),t.description_en&&e.jsx("p",{className:"form-error",style:{marginTop:"75px"},children:t.description_en.message})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("h2",{className:"fs-5 fw-bold",children:"Create Attribute"}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-5 multi",children:[e.jsx("label",{className:"form-label",children:"Attribute "}),e.jsx(f,{name:"attributeId",control:j,rules:{required:"Attribute is required"},render:({field:a})=>e.jsx(S,{...a,isMulti:!0,options:I?.map(s=>({value:s._id,label:s.name_en})),placeholder:"Select Attribute",className:t.attributeId?"react-select-error":"",classNamePrefix:"react-select",onChange:s=>a.onChange(s?.map(o=>o.value)||[]),value:I?.filter(s=>a.value?.includes(s._id)).map(s=>({value:s._id,label:s.name_en}))||[]})}),t.attributeId&&e.jsx("p",{className:"form-error",children:t.attributeId.message})]}),e.jsxs("div",{className:"col-md-5 multi",children:[e.jsx("label",{className:"form-label",children:"Value"}),e.jsx(f,{name:"valueId",control:j,rules:{required:"Value is required"},render:({field:a})=>e.jsx(S,{...a,isMulti:!0,options:w?.map(s=>({value:s._id,label:s.name_en})),placeholder:"Select Value",className:t.valueId?"react-select-error":"",classNamePrefix:"react-select",onChange:s=>a.onChange(s?.map(o=>o.value)||[]),value:w?.filter(s=>a.value?.includes(s._id)).map(s=>({value:s._id,label:s.name_en}))||[]})}),t.valueId&&e.jsx("p",{className:"form-error",children:t.valueId.message})]}),e.jsx("div",{className:"col-md-auto pt-4",children:e.jsx("button",{onClick:a=>{a.preventDefault(),R()},className:"comman-btn-main w-100 fs-6 mt-1",children:"Show Combination"})}),d?.length?e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"fw-semibold fs-5",children:"Attribute"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive shadow-sm rounded bg-white p-3",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Attribute Name"}),e.jsx("th",{children:"Combination"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Discounted Price"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:d?.map((a,s)=>a.map((o,l)=>e.jsxs("tr",{children:[e.jsx("td",{children:o.attributeName}),e.jsx("td",{children:e.jsx("div",{className:"badge bg-main",children:o.valueName})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control small-width",value:o.price||"",onChange:c=>{const r=[...d];r[s][l].price=c.target.value,m(r)}})}),e.jsxs("td",{children:[e.jsx("input",{type:"number",className:"form-control small-width",value:o.discountPrice||"",onChange:c=>{const r=[...d];r[s][l].discountPrice=c.target.value,m(r)}}),Number(o.discountPrice)>=Number(o.price)&&e.jsx("p",{className:"form-error",children:"Discounted price cannot be greater than base price"})]}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control small-width",value:o.quantity||"",onChange:c=>{const r=[...d];r[s][l].quantity=c.target.value,m(r)}})}),e.jsx("td",{className:"text-center",children:e.jsx("button",{className:"table-btn bg-danger",onClick:c=>{c.preventDefault();const r=[...d];r[s]=r[s].filter((i,G)=>G!==l),m(r)},children:e.jsx("i",{className:"fa fa-trash"})})})]},o._id)))})]})})})]})}):""]})})]}),e.jsx("div",{className:"col-12 mt-4",children:e.jsx("button",{type:"submit",className:"btn comman-btn-main",disabled:N,children:N?e.jsxs(e.Fragment,{children:[e.jsx(ee,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}),e.jsxs("span",{className:"ms-2",children:[" Wait... ",P,"%"]})]}):"Add"})})]})})})]})})]})]})})}const ie=K.memo(re);export{ie as default};
