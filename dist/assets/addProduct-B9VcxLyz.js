import{R as B,u as K,a as m,b as U,h as b,j as e,L as H,s as i,i as J,o as T,l as w,m as O,n as Q}from"./index-CwwJOC3T.js";import{S as W,H as X}from"./sideBar-BECWzmQU.js";import{u as Y,C as S,F as Z}from"./index-TZqrcM39.js";import{S as _,C as ee}from"./compressor.esm-DxtlAxol.js";function se(){const{isSidebarHidden:q}=K(),[j,x]=m.useState(!1),[n,d]=m.useState(!1),[p,f]=m.useState([]),[P,D]=m.useState(0),N=U(),{register:u,handleSubmit:A,formState:{errors:t},watch:c,control:v,setValue:y}=Y({mode:"onChange",defaultValues:{categoryId:"",subCategoryId:""}});m.useEffect(()=>{y("subCategoryId","")},[c("categoryId")]),m.useEffect(()=>{y("valueId",""),d([])},[c("attributeId")]),m.useEffect(()=>{d([])},[c("valueId")]);const{data:F}=b({queryKey:["categoryList"],queryFn:async()=>w({page:1,pageSize:1e3,categoryId:"",allSubcategory:!1,search:""}),onError:s=>{console.log(s)}}),E=F?.results?.categories||[],{data:L}=b({queryKey:["subCategoryList",c("categoryId")],queryFn:async()=>{const s={page:1,pageSize:1e3,categoryId:c("categoryId"),allSubcategory:!0,search:""};return w(s)},enabled:!!c("categoryId"),onError:s=>{console.log(s)}}),V=L?.results?.categories||[],{data:$}=b({queryKey:["attList"],queryFn:async()=>O({page:1,pageSize:1e3,search:""}),onError:s=>{console.log(s)}}),I=$?.results?.attributes||[],{data:k}=b({queryKey:["valueList",c("attributeId")],queryFn:async()=>{const s={page:1,pageSize:1e3,attributeIds:c("attributeId"),search:""};return Q(s)},enabled:!!c("attributeId"),onError:s=>{console.log(s)}}),C=k?.results?.values||[],M=async()=>{if(!c("attributeId")?.length&&!c("valueId")?.length){i("Please select attribute & value","error");return}console.log(c("attributeId"),c("valueId"));const s={selectedAttributes:c("attributeId"),selectedValues:c("valueId")};try{const a=await J(s);a.error?i(a.message,"error"):d(a.results.combinations[0])}catch{console.log("An error occurred")}finally{x(!1)}},z=async s=>{if(p.length<5){i("Please upload atleast 5 images","error");return}const a=n.filter(l=>!l.quantity||!l.price||!l.discountPrice);if(n.filter(l=>Number(l.discountPrice)>Number(l.price)).length>0)return;if(a.length>0){i("Please fill all required fields for variations","error");return}x(!0);const r=new FormData;r.append("name_en",s.name_en),r.append("description_en",s.description_en),r.append("categoryId",s.categoryId),r.append("subCategoryId",s.subCategoryId),r.append("calories",s.calories),r.append("type",s.type),p.forEach(l=>{r.append("images",l)});const h=n.map(l=>({quantity:l.quantity||0,price:l.price||0,discountPrice:l.discountPrice||0,combination:[{attributeId:l.attributeId,valueId:l.valueId}]}));r.append("variants",JSON.stringify(h));try{const l=await T(r,g=>{D(Math.round(100*g.loaded/g.total))});l.error?i(l.message,"error"):(i(l.message,"success"),N("/merchant/products"))}catch{console.log("An error occurred")}finally{x(!1)}},R=s=>{const a=Array.from(s.target.files),o=5*1024*1024;let r=!1;a.forEach(h=>{if(h.size>o){r=!0;return}new ee(h,{quality:.6,success(l){f(g=>[...g,l])},error(l){i(`Failed to compress ${h.name}`,"error")}})}),r&&i("Some files exceed 5MB limit and were not added","error"),s.target.value=""},G=s=>{const a=p.filter((o,r)=>r!==s);f(a)};return console.log(n),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"admin-wrapper d-flex",children:[e.jsx(W,{}),e.jsxs("div",{className:q?"main-content flex-grow-1 full":"main-content flex-grow-1",id:"main-content",children:[e.jsx(X,{}),e.jsx("main",{className:"p-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("div",{className:"d-flex gap-3 align-items-center justify-content-between",children:[e.jsx("h3",{className:"fw-semibold fs-5",children:" Add Product"}),e.jsxs(H,{to:"",onClick:()=>N(-1),className:"btn btn-sm btn-light",children:[e.jsx("i",{className:"fa fa-arrow-left me-2"})," Go Back"]})]})}),e.jsx("div",{className:"card-body",children:e.jsx("form",{onSubmit:A(z),children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"upload-img",children:[e.jsx("input",{type:"file",id:"productImage",className:"d-none",accept:"image/*",multiple:!0,onChange:R}),e.jsxs("label",{htmlFor:"productImage",className:"upload-content",children:[e.jsx("i",{className:"fa fa-cloud-upload"}),e.jsx("p",{className:"mb-0",children:"Click to upload at least 5 images"}),e.jsx("small",{className:"text-muted",children:"PNG, JPG, JPEG (Max 5MB)"})]})]}),p.length>0&&e.jsx("div",{className:"row mt-3 g-2",children:p.map((s,a)=>e.jsxs("div",{className:"col-3 position-relative img-wrap",children:[e.jsx("img",{src:URL.createObjectURL(s),alt:`Preview ${a+1}`,className:"img-fluid rounded shadow-sm",style:{width:"100%",height:"100px",objectFit:"cover"}}),e.jsx("i",{className:"fas fa-remove",onClick:()=>G(a)})]},a))})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Product Name"}),e.jsx("input",{type:"text",placeholder:"Enter product name",className:`form-control ${t.name_en?"input-error":""}`,...u("name_en",{required:"Product Name is required"})}),t.name_en&&e.jsx("p",{className:"form-error",children:t.name_en.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Category"}),e.jsxs("select",{className:`form-control form-select ${t.categoryId?"input-error":""}`,...u("categoryId",{required:"Category  is required"}),children:[e.jsx("option",{value:"",hidden:!0,children:"Select Category"}),E?.map(s=>e.jsx("option",{value:s._id,children:s.name_en},s._id))]}),t.categoryId&&e.jsx("p",{className:"form-error",children:t.categoryId.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Subcategory"}),e.jsxs("select",{className:`form-control form-select ${t.subCategoryId?"input-error":""}`,...u("subCategoryId",{required:"Sub Category  is required"}),children:[e.jsx("option",{hidden:!0,value:"",children:"Select Sub Category"}),V?.map(s=>e.jsx("option",{value:s._id,children:s.name_en},s._id))]}),t.subCategoryId&&e.jsx("p",{className:"form-error",children:t.subCategoryId.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Calories"}),e.jsx("input",{type:"number",placeholder:"Enter calories",className:`form-control ${t.calories?"input-error":""}`,...u("calories",{required:!1})}),t.calories&&e.jsx("p",{className:"form-error",children:t.calories.message})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Type"}),e.jsxs("select",{className:`form-control form-select ${t.type?"input-error":""}`,...u("type",{required:"Type is required"}),children:[e.jsx("option",{value:"",hidden:!0,children:"Select Type"}),e.jsx("option",{value:"Veg",children:"Veg"}),e.jsx("option",{value:"Non Veg",children:"Non-Veg"})]}),t.type&&e.jsx("p",{className:"form-error",children:t.type.message})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{id:"textarea",placeholder:"Enter description",className:`form-control ${t.description_en?"input-error":""}`,...u("description_en",{required:"Description is required"}),style:{height:"130px!important"}}),t.description_en&&e.jsx("p",{className:"form-error",children:t.description_en.message})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("h2",{className:"fs-5 fw-bold",children:"Create Attribute"}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-5 multi",children:[e.jsx("label",{className:"form-label",children:"Attribute "}),e.jsx(S,{name:"attributeId",control:v,rules:{required:"Attribute is required"},render:({field:s})=>e.jsx(_,{...s,isMulti:!0,options:I?.map(a=>({value:a._id,label:a.name_en})),placeholder:"Select Attribute",className:t.attributeId?"react-select-error":"",classNamePrefix:"react-select",onChange:a=>s.onChange(a?.map(o=>o.value)||[]),value:I?.filter(a=>s.value?.includes(a._id)).map(a=>({value:a._id,label:a.name_en}))||[]})}),t.attributeId&&e.jsx("p",{className:"form-error",children:t.attributeId.message})]}),e.jsxs("div",{className:"col-md-5 multi",children:[e.jsx("label",{className:"form-label",children:"Value"}),e.jsx(S,{name:"valueId",control:v,rules:{required:"Value is required"},render:({field:s})=>e.jsx(_,{...s,isMulti:!0,options:C?.map(a=>({value:a._id,label:a.name_en})),placeholder:"Select Value",className:t.valueId?"react-select-error":"",classNamePrefix:"react-select",onChange:a=>s.onChange(a?.map(o=>o.value)||[]),value:C?.filter(a=>s.value?.includes(a._id)).map(a=>({value:a._id,label:a.name_en}))||[]})}),t.valueId&&e.jsx("p",{className:"form-error",children:t.valueId.message})]}),e.jsx("div",{className:"col-md-auto pt-4",children:e.jsx("button",{onClick:s=>{s.preventDefault(),M()},className:"comman-btn-main w-100 fs-6 mt-1",children:"Show Combination"})}),n?.length?e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card shadow",children:[e.jsx("div",{className:"card-header",children:e.jsx("h3",{className:"fw-semibold fs-5",children:"Attribute"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive shadow-sm rounded bg-white p-3",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"S.No"}),e.jsx("th",{children:"Attribute Name"}),e.jsx("th",{children:"Combination"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Discounted Price"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:n?.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:a+1}),e.jsx("td",{children:s.attributeName}),e.jsx("td",{children:e.jsx("div",{className:"badge bg-main",children:s.valueName})}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control small-width",value:s.price||"",onChange:o=>{const r=[...n];r[a]={...r[a],price:o.target.value},d(r)}})}),e.jsxs("td",{children:[e.jsx("input",{type:"number",className:"form-control small-width",value:s.discountPrice||"",onChange:o=>{const r=[...n];r[a]={...r[a],discountPrice:o.target.value},d(r)}}),Number(s.discountPrice)>=Number(s.price)&&e.jsx("p",{className:"form-error",children:"Discounted price cannot be greater than base price"})]}),e.jsx("td",{children:e.jsx("input",{type:"number",className:"form-control small-width",value:s.quantity||"",onChange:o=>{const r=[...n];r[a]={...r[a],quantity:o.target.value},d(r)}})}),e.jsx("td",{className:"text-center",children:e.jsx("button",{className:"table-btn bg-danger",onClick:o=>{o.preventDefault();const r=n.filter((h,l)=>l!==a);d(r)},children:e.jsx("i",{className:"fa fa-trash"})})})]},s._id))})]})})})]})}):""]})})]}),e.jsx("div",{className:"col-12 mt-4",children:e.jsx("button",{type:"submit",className:"btn comman-btn-main",disabled:j,children:j?e.jsxs(e.Fragment,{children:[e.jsx(Z,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}),e.jsxs("span",{className:"ms-2",children:[" Wait... ",P,"%"]})]}):"Add"})})]})})})]})})]})]})})}const ce=B.memo(se);export{ce as default};
